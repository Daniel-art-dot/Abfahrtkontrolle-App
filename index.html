<!doctype html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Abfahrtskontrolle LKW – Lerntrainer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
      color: #111827;
    }
    body {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background: #111827;
      color: #f9fafb;
      padding: 0.75rem 1rem;
      text-align: center;
    }
    header h1 {
      font-size: 1.1rem;
      margin: 0;
    }
    header p {
      font-size: 0.8rem;
      margin: 0.25rem 0 0;
      opacity: 0.8;
    }
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      padding: 0.75rem;
      max-width: 1200px;
      margin: 0 auto;
      box-sizing: border-box;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
    }
    .controls > * {
      font-size: 0.85rem;
    }
    select, button {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 0.35rem 0.75rem;
      background: #ffffff;
    }
    button {
      cursor: pointer;
    }
    button.primary {
      background: #2563eb;
      color: white;
      border-color: #1d4ed8;
    }
    button.primary:active {
      transform: scale(0.98);
    }
    button.danger {
      border-color: #ef4444;
      color: #b91c1c;
    }
    button.danger:active {
      transform: scale(0.98);
    }
    .mode-toggle {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
    }
    .mode-toggle button {
      min-width: 140px;
      text-align: center;
    }
    .progress-bar-container {
      flex: 1 1 100%;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
      height: 0.6rem;
      position: relative;
    }
    .progress-bar-fill {
      height: 100%;
      width: 0%;
      background: #16a34a;
      transition: width 0.2s ease;
    }
    .progress-text {
      font-size: 0.75rem;
      color: #4b5563;
    }
    .card-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      overflow-y: auto;
      padding-bottom: 0.5rem;
    }
    .question-card {
      background: #ffffff;
      border-radius: 0.75rem;
      padding: 0.75rem 0.9rem;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08);
    }
    .question-meta {
      font-size: 0.75rem;
      color: #6b7280;
      margin-bottom: 0.25rem;
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .question-title {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 0.35rem;
    }
    .answer {
      margin-top: 0.4rem;
      padding: 0.5rem 0.6rem;
      border-radius: 0.5rem;
      background: #f9fafb;
      font-size: 0.85rem;
      white-space: pre-wrap;
      border: 1px dashed #e5e7eb;
    }
    .answer.hidden {
      display: none;
    }
    .card-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-top: 0.4rem;
    }
    .small {
      font-size: 0.75rem;
    }
    .chip {
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 0.1rem 0.5rem;
      font-size: 0.7rem;
      background: #f9fafb;
    }
    .chip.known {
      background: #dcfce7;
      border-color: #16a34a;
      color: #166534;
    }
    .chip.unknown {
      background: #fee2e2;
      border-color: #ef4444;
      color: #991b1b;
    }
    textarea {
      width: 100%;
      min-height: 3.2rem;
      resize: vertical;
      font-size: 0.8rem;
      padding: 0.35rem 0.4rem;
      border-radius: 0.5rem;
      border: 1px solid #e5e7eb;
      box-sizing: border-box;
      font-family: inherit;
    }
    .note-label {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.4rem;
      margin-bottom: 0.2rem;
    }
    .mode-info {
      font-size: 0.75rem;
      color: #6b7280;
    }
    .footer-hint {
      font-size: 0.7rem;
      text-align: center;
      color: #9ca3af;
      margin-top: 0.3rem;
    }
    .exam-summary-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.3rem;
    }
    .exam-summary-line {
      font-size: 0.9rem;
      margin: 0.15rem 0;
    }
    .image-wrapper {
      margin-top: 0.4rem;
      display: none;
    }
    .image-wrapper img {
      max-width: 100%;
      border-radius: 0.5rem;
      border: 1px solid #e5e7eb;
      display: block;
    }
    .image-caption {
      font-size: 0.7rem;
      color: #6b7280;
      margin-top: 0.2rem;
    }
    @media (min-width: 768px) {
      main {
        padding: 1rem;
      }
      header h1 {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
<header>
  <h1>Abfahrtskontrolle LKW – Lerntrainer</h1>
  <p>Lernkarten, Quiz &amp; Prüfungsmodus (mit optionalen Bildern pro Frage)</p>
</header>
<main>
  <div class="controls">
    <label>
      Karte:
      <select id="cardFilter">
        <option value="all">Alle Karten</option>
      </select>
    </label>

    <div class="mode-toggle">
      <button id="modeCardsBtn" class="primary">Jetzt Karten lernen</button>
      <button id="modeQuizBtn">Quiz (Zufallsfrage)</button>
      <button id="modeExamBtn">Prüfungsmodus</button>
      <button id="nextInQuiz" class="primary" style="display:none;">Nächste Frage</button>
    </div>

    <div class="progress-bar-container">
      <div class="progress-bar-fill" id="progressFill"></div>
    </div>
    <div class="progress-text" id="progressText">Fortschritt: 0 / 0 (0%)</div>

    <button id="resetAll" class="danger">Reset: Fortschritt &amp; Notizen löschen</button>

    <div class="mode-info" id="modeInfo">
      Modus: <strong>Lernkarten</strong> – blättere durch alle Fragen, zeige dir die Antwort an und bewerte dich.
    </div>
  </div>

  <div class="card-list" id="cardList"></div>

  <div class="footer-hint">
    Fortschritt &amp; Notizen werden lokal im Browser gespeichert (keine Cloud, keine Anmeldung).<br>
    Bilder: einfach in <code>img/</code> legen, z.&nbsp;B. <code>img/fahrtenschreiber_k1f1.jpg</code>, und bei der Frage <code>image</code> + <code>imageLabel</code> eintragen.
  </div>
</main>

<script>
// Fragenkatalog – Beispiel mit Bild bei K1F1
const QUESTIONS = [
  // Karte 1
  {
    id: "K1F1",
    card: 1,
    title: "Frage 1: Aufgaben vor Fahrtantritt am Fahrtenschreiber*",
    answer: `• Zündung einschalten, Fahrerkarte stecken
• UTC-Zeit und Name kontrollieren
• Nachtrag durchführen (vorherige Tätigkeiten)
• Beginn Land eingeben: Deutschland
• Gerät auf Arbeitszeit stellen

Erst alles korrekt einstellen – sonst drohen Bußgelder.`,
    image: "img/fahrtenschreiber_k1f1.jpg",
    imageLabel: "Digitaler Fahrtenschreiber – Beispielanzeige (Karte 1, Frage 1)"
  },
  {
    id: "K1F2",
    card: 1,
    title: "Frage 2: Kontrolle des Standes der Bremsflüssigkeit.",
    answer: `• Beim LKW keine Bremsflüssigkeit: System ist eine Druckluftbremse
• Stattdessen: Vorratsdruck und Warnanzeigen im Cockpit prüfen

Bremsflüssigkeit ist ein PKW-Thema – LKW bremst mit Luft.`
  },
  {
    id: "K1F3",
    card: 1,
    title: "Frage 3: Prüfen der Reifengröße anhand der Zulassungsbescheinigung Teil I (Fahrzeugschein).",
    answer: `• Reifengröße am Reifen mit Eintrag im Schein vergleichen
• Punkte 15.1, 15.2 und 15.3 müssen übereinstimmen
• Beispiel: 385/70 R22.5

Daten müssen exakt übereinstimmen – sonst erlischt die Betriebserlaubnis.`
  },
  {
    id: "K1F4",
    card: 1,
    title: "Frage 4: Bremsleuchten, Kennzeichenbeleuchtung, Rückstrahler prüfen.",
    answer: `• Fahrlehrer Licht einschalten lassen, Bremsen betätigen
• Kennzeichenbeleuchtung prüfen
• Rückstrahler: Sauberkeit und Beschädigungen kontrollieren

Alles hinten: hell, sauber, heil.`
  },
  {
    id: "K1F5",
    card: 1,
    title: "Frage 5: Sichtprüfung von Kühler und Kühlleitungen, Kontrolle des Kühlflüssigkeitsstandes.",
    answer: `• Kühler: keine Undichtigkeiten, keine Verschmutzungen (z. B. Blätter, Tüten), Lamellen nicht beschädigt oder verbogen
• Kühlleitungen: keine Risse, nicht porös, Schellen fest
• Kühlmittelstand: es erscheint eine Warnmeldung, wenn der Stand zu gering ist – Auffüllen nur bei kaltem Motor

Nie bei heißem Motor öffnen – Verbrühungsgefahr!`
  },
  {
    id: "K1F6",
    card: 1,
    title: "Frage 6: Warnleuchte (Funktion), Warndreieck, Warnweste (Vorhandensein).",
    answer: `• Warnleuchte: Funktion prüfen → einschalten, Blinklicht zuschalten, dann auf „Test“ stellen (Batteriecheck)
• Standfüße kontrollieren: Lampe muss sicher stehen
• CE-Zeichen und Sinuswelle prüfen
• Warndreieck: vorhanden, nicht beschädigt
• Warnweste: EN 471, richtige Größe, sauber, nicht beschädigt

Nur geprüfte und funktionsfähige Warnmittel verwenden.`
  },

  // Karte 2
  {
    id: "K2F1",
    card: 2,
    title: "Frage 1: Bedienung der Schalter am Fahrtenschreiber.*",
    answer: `• „Zurück“-Taste links
• Pfeil hoch/runter: Navigation
• „OK“: Menü öffnen/bestätigen
• „Fahrer 1“-Taste: Tätigkeiten einstellen oder Karte auswerfen

Tasten sicher beherrschen = korrekte Bedienung.`
  },
  {
    id: "K2F2",
    card: 2,
    title: "Frage 2: Prüfen der Druckwarneinrichtung.",
    answer: `• Zündung einschalten, Bremse mehrfach treten, bis „Vorratsdruck zu gering“ erscheint
• Motor starten: STOP-Warnung leuchtet → Warneinrichtung funktioniert

Warnung muss deutlich erscheinen – sonst defekt.`
  },
  {
    id: "K2F3",
    card: 2,
    title: "Frage 3: Prüfen der Tragfähigkeit und Höchstgeschwindigkeit der Reifen anhand der Zulassungsbescheinigung Teil I.",
    answer: `• Tragfähigkeit und Höchstgeschwindigkeit am Reifen mit den Angaben vergleichen
• Werte auf dem Reifen dürfen höher, aber niemals niedriger sein
• Bei Doppelachse: zwei Tragfähigkeiten, z. B. 154/150 → die zweite Zahl gilt

Immer den niedrigeren Wert bei Doppelbereifung beachten – der ist gültig.`
  },
  {
    id: "K2F4",
    card: 2,
    title: "Frage 4: Hupe / Lichthupe / Warnblinklicht / Seitenmarkierungsleuchten, Funktion prüfen.",
    answer: `• Hupe betätigen
• Lichthupe betätigen
• Warnblinker einschalten, Funktion um den LKW gehen kontrollieren
• Seitenmarkierungsleuchten ebenfalls um den LKW gehen prüfen

Einmal um den LKW gehen – nichts übersehen.`
  },
  {
    id: "K2F5",
    card: 2,
    title: "Frage 5: Sichtprüfung von Kühler und Kühlleitungen, Kontrolle des Kühlflüssigkeitsstandes.",
    answer: `• Kühler: keine Undichtigkeiten, keine Verschmutzungen (z. B. Blätter, Tüten), Lamellen nicht beschädigt oder verbogen
• Kühlleitungen: keine Risse, nicht porös, Schellen fest
• Kühlmittelstand: es erscheint eine Warnmeldung, wenn der Stand zu gering ist – Auffüllen nur bei kaltem Motor

Nie bei heißem Motor öffnen – Verbrühungsgefahr!`
  },
  {
    id: "K2F6",
    card: 2,
    title: "Frage 6: Unterlegkeile (Anzahl, Unterbringung).",
    answer: `• Unterbringung in Halterung prüfen
• Anzahl vollständig (bei 3 Achsen: 2 Keile)
• Keile nicht beschädigt, passend zur Reifengröße
• Auf die Eiskanten achten – dürfen nicht beschädigt sein

Nur vollständige, passende Keile sichern richtig.`
  },

  // Karte 3
  {
    id: "K3F1",
    card: 3,
    title: "Frage 1: Bedeutung der Kontrolllampen des Fahrtenschreibers; Ausfall des Geräts.*",
    answer: `• Gelbes T = Fahrerkarte fehlt oder Lenkzeit bald erreicht
• Rotes T = Gerätestörung oder Fehlermeldung
• Anzeige tot → Tätigkeiten manuell dokumentieren

Rotes T = sofort handeln, Ausfall dokumentieren.`
  },
  {
    id: "K3F2",
    card: 3,
    title: "Frage 2: Sichtprüfung der Betriebs- und Feststellbremse.",
    answer: `• Bremsscheiben: keine Risse, Brüche, blauen Verfärbungen, tiefen Riefen, nicht ölig
• Bremsbeläge im Bordcomputer kontrollieren
• Feststellbremse: Handbremse anziehen und Halt prüfen
• Kombizylinder: Schraube nicht rausgedreht

Bremsen prüfen = Lebensversicherung.`
  },
  {
    id: "K3F3",
    card: 3,
    title: "Frage 3: Sichtprüfung des Sitzes der Radmuttern.",
    answer: `• Alle Radmuttern vorhanden
• Gleichmäßig angezogen (an den Gewindegängen erkennbar)
• Keine Rostnasen hinter Radmuttern
• Radmuttern nicht beschädigt oder gebrochen

Lose Radmuttern = Radverlustgefahr!`
  },
  {
    id: "K3F4",
    card: 3,
    title: "Frage 4: Standlicht, Abblendlicht, Fernlicht, Umrissleuchten vorne, Funktion prüfen.",
    answer: `• Fahrlehrer schaltet Licht ein
• Fahrschüler geht vor das Fahrzeug
• Standlicht, Abblendlicht, Fernlicht prüfen
• Umrissleuchten vorne kontrollieren

Lichtfunktion immer paarweise prüfen.`
  },
  {
    id: "K3F5",
    card: 3,
    title: "Frage 5: Kontrolle des Motorölstandes.",
    answer: `• Im Bordcomputer kontrollieren
• LKW muss gerade stehen, mehrere Stunden abgekühlt (ca. 6 Std.)
• Manuelle Kontrolle mit Messstab nur bei gekipptem Fahrerhaus

Falscher Ölstand = Motorschaden.`
  },
  {
    id: "K3F6",
    card: 3,
    title: "Frage 6: Verbandskasten (Unterbringung).",
    answer: `• Seitenfach öffnen, Verbandskasten entnehmen
• Richtige DIN-Norm, Ablaufdatum, Vollständigkeit prüfen
• Verbandkasten nicht beschädigt

Abgelaufen oder unvollständig → Bußgeld + Risiko.`
  },

  // Karte 4
  {
    id: "K4F1",
    card: 4,
    title: "Frage 1: Benennen der Symbole auf dem Fahrtenschreiber.*",
    answer: `• Hammer = Arbeitszeit
• Bett = Ruhezeit
• Kreis mit Punkt = Lenkzeit
• Viereck mit Schrägstrich = Bereitschaft

Nur richtige Tätigkeit einstellen – keine Fehlaufzeichnungen.`
  },
  {
    id: "K4F2",
    card: 4,
    title: "Frage 2: Prüfen, ob Pedalwege frei sind.",
    answer: `• Unter Pedale schauen: keine Gegenstände (Handschuhe, Flaschen, Hausschuhe)
• Gas/Bremse betätigen: freigängig, kein Widerstand
• Im Fahrerhaus prüfen: keine losen Teile oder Flaschen, die nach vorne rollen könnten

Freie Pedale = sichere Bedienung.`
  },
  {
    id: "K4F3",
    card: 4,
    title: "Frage 3: Prüfen des Reifenzustandes.",
    answer: `• Profil: mind. 1,6 mm, gleichmäßig, nichts herausgerissen
• Beschädigungen: keine Schnitte, Beulen, Risse an den Flanken
• Fremdkörper: keine Schrauben, Nägel, bei Zwillingsbereifung keine Steine oder andere Gegenstände
• Reifendruck: LKW muss gerade stehen, keine starke Bauchbildung
• Zwillingsbereifung: inneren Reifen mit Hammer abklopfen

Zwillingsbereifung wird oft übersehen!`
  },
  {
    id: "K4F4",
    card: 4,
    title: "Frage 4: Hupe / Lichthupe / Warnblinklicht / Seitenmarkierungsleuchten, Funktion prüfen.",
    answer: `• Hupe betätigen
• Lichthupe betätigen
• Warnblinker einschalten, Funktion um den LKW gehen kontrollieren
• Seitenmarkierungsleuchten ebenfalls um den LKW gehen prüfen

Einmal um den LKW gehen – nichts übersehen.`
  },
  {
    id: "K4F5",
    card: 4,
    title: "Frage 5: Dichtheit der Kraftstoffanlage prüfen.",
    answer: `• Tank: nicht beschädigt, richtig befestigt
• Tankdeckel: vorhanden und verschlossen
• Anschlüsse: keine Undichtigkeiten
• Kraftstoffleitungen: vom Tank bis Motor → dicht, nichts läuft aus
• Vorrat: Anzeige im Cockpit prüfen
• AdBlue: Vorrat prüfen

Tankdeckel + AdBlue nicht vergessen.`
  },
  {
    id: "K4F6",
    card: 4,
    title: "Frage 6: Warnleuchte (Funktion), Warndreieck, Warnweste (Vorhandensein).",
    answer: `• Warnleuchte: Funktion prüfen → einschalten, Blinklicht zuschalten, dann auf „Test“ stellen (Batteriecheck)
• Standfüße kontrollieren: Lampe muss sicher stehen
• CE-Zeichen und Sinuswelle prüfen
• Warndreieck: vorhanden, nicht beschädigt
• Warnweste: EN 471, richtige Größe, sauber, nicht beschädigt

Nur geprüfte und funktionsfähige Warnmittel verwenden.`
  },

  // Karte 5
  {
    id: "K5F1",
    card: 5,
    title: "Frage 1: Überprüfung eines Schaublattes bzw. eines Ausdruckes des Fahrtenschreibers.*",
    answer: `a) Wie viele km wurden gefahren?
b) Wie lange war die Fahrtunterbrechung?
c) Nach wie viel Stunden wurde die erste Pause eingelegt?
d) Welche Höchstgeschwindigkeit wurde gefahren bzw. wurden Geschwindigkeitsüberschreitungen dokumentiert?

• Gefahrene Strecke: 89 km
• Fahrtunterbrechung: 20 Stunden 26 Minuten
• Erste Pause: nach 1 Stunde 47 Minuten
• Geschwindigkeitsüberschreitungen: keine dokumentiert

Werte sauber am Ausdruck/Schaublatt ablesen – nichts schätzen.`
  },
  {
    id: "K5F2",
    card: 5,
    title: "Frage 2: Vorratsdruck aufbauen, Fahrbereitschaft feststellen.",
    answer: `• Manometer prüfen
• Keine Druckwarnanzeige aktiv → Fahrzeug fahrbereit
• Wenn zu wenig Vorratsdruck: Motor starten und warten, bis die Druckwarnanzeige erlischt
• Den Prüfer informieren: Fahrzeug ist fahrbereit

Druck prüfen, Warnleuchte aus – dann fahrbereit.`
  },
  {
    id: "K5F3",
    card: 5,
    title: "Frage 3: Prüfen der Felgen auf Beschädigung.",
    answer: `• Felgenhorn: keine Eindrückungen oder Scharfkanten
• Keine Risse zwischen den Luftlöchern oder an den Radmuttern
• Schweißnaht darf nicht ausgebrochen sein

Felgen sorgfältig rundum prüfen.`
  },
  {
    id: "K5F4",
    card: 5,
    title: "Frage 4: Standlicht, Abblendlicht, Fernlicht, Umrissleuchten vorne, Funktion prüfen.",
    answer: `• Fahrlehrer schaltet die jeweilige Beleuchtung ein
• Fahrschüler geht vor das Fahrzeug und kontrolliert nacheinander:
  • Standlicht → leuchtet vorne beidseitig
  • Abblendlicht → leuchtet vorne beidseitig
  • Fernlicht → blaues Symbol im Cockpit + beide Scheinwerfer leuchten
  • Umrissleuchten vorne → sichtbar eingeschaltet

Immer systematisch beide Seiten prüfen – nichts übersehen.`
  },
  {
    id: "K5F5",
    card: 5,
    title: "Frage 5: Sichtprüfung des Antriebs von Nebenaggregaten (z. B. Lichtmaschine, Servo- und Wasserpumpe).",
    answer: `• In der Prüfung wird das Fahrerhaus nicht gekippt – der Fahrschüler erklärt, was geprüft würde
• Flachriemen: keine Risse, nicht porös, nicht ausgefranst, keine Ölspuren
• Spannung nur nennen, wenn Prüfer fragt:
  • 45° Drehung (Flachriemen)
  • Daumenbreite Eindrückung (Keilriemen)

Defekter Riemen reißt – vorher erkennen!`
  },
  {
    id: "K5F6",
    card: 5,
    title: "Frage 6: Zustand der Scheiben und Spiegel (Sauberkeit, Beschädigung).",
    answer: `• Spiegel: fest, nicht wackelnd, nicht beschädigt, keine schwarzen Punkte, nicht milchig
• Windschutzscheibe: sauber, nicht beschädigt, keine Steinschläge im Sichtfeld/Kamerabereich

Freie Sicht = sichere Fahrt.`
  },

  // Karte 6
  {
    id: "K6F1",
    card: 6,
    title: "Frage 1: Ausfüllen des Schaublattes des Fahrtenschreibers bzw. Abmeldung am Fahrtenschreiber am Ende einer Fahrt.*",
    answer: `• LKW hat kein Schaublatt → Abmeldung am Fahrtenschreiber
• Gerät auf Ruhezeit stellen
• Auswurftaste drücken
• Ende Land eingeben: Deutschland
• Kein Ausdruck nötig, nur wenn am Tag etwas vorgefallen ist

Immer korrekt abmelden – sonst Bußgelder.`
  },
  {
    id: "K6F2",
    card: 6,
    title: "Frage 2: Vorratsdruck aufbauen, Fahrbereitschaft feststellen.",
    answer: `• Manometer prüfen
• Keine Druckwarnanzeige aktiv → fahrbereit
• Wenn zu wenig Vorratsdruck: Motor starten, warten bis die Druckwarnanzeige erlischt
• Den Prüfer informieren: Fahrzeug ist fahrbereit

Druck prüfen, Warnleuchte aus – dann fahrbereit.`
  },
  {
    id: "K6F3",
    card: 6,
    title: "Frage 3: Prüfung der Reserveradsicherung.",
    answer: `• Doppelte Sicherung kontrollieren:
  • Seil der Hubeinrichtung (zum Hochziehen des Reifens)
  • Verschraubung des Reserverads
• Beide Sicherungen müssen fest sein

Immer an die doppelte Sicherung denken.`
  },
  {
    id: "K6F4",
    card: 6,
    title: "Frage 4: Kontrolllampen benennen oder Kontrollsysteme aktivieren und an zwei Beispielen erläutern.",
    answer: `• Zwei Kontrollleuchten benennen (z. B. Feststellbremse rot, Fernlicht blau)
• Kontrollsysteme nennen: Kraftstoffanzeige, Druckmesser/Manometer
• Wenn Prüfer eine unbekannte Leuchte zeigt: Hinweis auf Betriebsanleitung

Mindestens zwei Beispiele nennen – das reicht dem Prüfer.`
  },
  {
    id: "K6F5",
    card: 6,
    title: "Frage 5: Kontrolle des Motorölstandes.",
    answer: `• Im Bordcomputer prüfen
• LKW muss gerade stehen und abgekühlt sein (ca. 6 Stunden)
• Manuelle Überprüfung nur möglich, wenn Fahrerhaus gekippt wird (in der Prüfung nicht kippen!)

Nur den Bordcomputer nutzen – Fahrerhaus in der Prüfung nicht kippen.`
  },
  {
    id: "K6F6",
    card: 6,
    title: "Frage 6: Sichtprüfung der Anhängerkupplung.",
    answer: `• Kupplung geschlossen
• Kontrollstift prüfen → korrekt eingerastet
• Fangmaul: keine Risse, keine Brüche, nicht beschädigt
• Verschraubungen fest
• Traverse: keine Risse
• Typenschild an der Anhängerkupplung vorhanden

Kupplung immer auf sicheren Sitz prüfen.`
  },

  // Karte 7
  {
    id: "K7F1",
    card: 7,
    title: "Frage 1: Aufgaben vor Fahrtantritt am Fahrtenschreiber*",
    answer: `• Zündung einschalten, Fahrerkarte stecken
• UTC-Zeit und Name kontrollieren
• Nachtrag durchführen (vorherige Tätigkeiten)
• Beginn Land eingeben: Deutschland
• Gerät auf Arbeitszeit stellen

Erst alles korrekt einstellen – sonst drohen Bußgelder.`
  },
  {
    id: "K7F2",
    card: 7,
    title: "Frage 2: Prüfen der Druckwarneinrichtung.",
    answer: `• Zündung einschalten, Bremse mehrfach treten, bis „Vorratsdruck zu gering“ erscheint
• Motor starten: STOP-Warnung leuchtet → Warneinrichtung funktioniert

Warnung muss deutlich erscheinen – sonst defekt.`
  },
  {
    id: "K7F3",
    card: 7,
    title: "Frage 3: Funktion der Lenkhilfe prüfen.",
    answer: `• Fahrschüler setzt sich ins Fahrerhaus
• Lenkrad auf Spannung halten, Motor starten
• Lenkrad muss nachgeben → Lenkhilfe funktioniert

Nicht mit Lenkspiel verwechseln – andere Aufgabe.`
  },
  {
    id: "K7F4",
    card: 7,
    title: "Frage 4: Bremsleuchten, Kennzeichenbeleuchtung, Rückstrahler prüfen.",
    answer: `• Fahrlehrer tritt Bremse, Fahrschüler geht hinter das Fahrzeug
• Bremsleuchten links/rechts prüfen
• Kennzeichenbeleuchtung prüfen
• Rückstrahler: sauber und nicht beschädigt

Alles hinten: hell, sauber, heil.`
  },
  {
    id: "K7F5",
    card: 7,
    title: "Frage 5: Sichtprüfung des Antriebs von Nebenaggregaten (z. B. Lichtmaschine, Servo- und Wasserpumpe).",
    answer: `• In der Prüfung wird das Fahrerhaus nicht gekippt – nur erklären, was geprüft würde
• Flachriemen: keine Risse, nicht porös, nicht ausgefranst, keine Ölspuren
• Spannung nur nennen, wenn Prüfer fragt:
  • 45° Drehung (Flachriemen)
  • Daumenbreite Eindrückung (Keilriemen)

Defekter Riemen reißt – vorher erkennen!`
  },
  {
    id: "K7F6",
    card: 7,
    title: "Frage 6: Bordwände, Verschlüsse, Gepäckklappen, Ladeeinrichtung, Ladungssicherung.",
    answer: `• Bordwände: keine Beschädigungen oder Ausbeulungen, Rolltor geschlossen
• Verschlüsse: Wechselbrücke und Stützen gesichert
• Gepäckklappen am Fahrerhaus geschlossen
• Ladeeinrichtung: keine vorhanden (sonst Zustand/Befestigung prüfen)
• Ladungssicherung: Rolltor öffnen, hier keine Ladung; dem Prüfer formschlüssig und kraftschlüssig nennen

Erst Zustand, dann Sicherungsarten nennen.`
  },

  // Karte 8
  {
    id: "K8F1",
    card: 8,
    title: "Frage 1: Bedienung der Schalter am Fahrtenschreiber.*",
    answer: `• „Zurück“-Taste (links)
• Pfeil hoch/runter: Navigation
• „OK“: Menü öffnen/bestätigen
• „Fahrer 1“-Taste: Tätigkeiten einstellen / Karte auswerfen

Tasten sicher beherrschen = korrekte Bedienung.`
  },
  {
    id: "K8F2",
    card: 8,
    title: "Frage 2: Vorrat des Frostschutzmittels prüfen.",
    answer: `• LKW hat kein Frostschutzmittel, sondern einen Lufttrockner
• An den Luftbehältern: Entwässerungsventil betätigen → kein Wasser darf austreten
• Im Bordcomputer prüfen, wann der Lufttrockner zu wechseln ist

Kein Wasser am Ventil = Anlage arbeitet richtig.`
  },
  {
    id: "K8F3",
    card: 8,
    title: "Frage 3: Lenkungsspiel prüfen.",
    answer: `• Motor starten, Blick auf den Reifen
• Lenkrad vorsichtig links/rechts bewegen → prüfen, ob Längsspiel vorhanden ist (soll nicht sein)
• 2–3 Finger Spiel sind noch in Ordnung

Längsspiel darf nur minimal sein – sonst Werkstatt.`
  },
  {
    id: "K8F4",
    card: 8,
    title: "Frage 4: Batterie (Anschlüsse, Befestigung) prüfen.",
    answer: `• Batterie sitzt fest, darf nicht verrutschen
• Kabel fest verbunden
• Pole abgedeckt und gefettet
• Keine Säure ausgetreten, Batterie sauber

Lose Batterie = Brand-/Ausfallgefahr.`
  },
  {
    id: "K8F5",
    card: 8,
    title: "Frage 5: Flüssigkeitsvorrat in Scheiben- und Scheinwerferwaschanlage kontrollieren.",
    answer: `• Kontrollleuchte im Cockpit benennen/zeigen (geht nur bei geringem Stand an)
• Wenn Prüfer fragt: Motorhaube öffnen, blauen Deckel zeigen (Nachfüllöffnung)

Bei geringem Stand erscheint eine Warnmeldung.`
  },
  {
    id: "K8F6",
    card: 8,
    title: "Frage 6: Plane / Spriegel (Zustand und Befestigung kontrollieren, Prüfen ob Plane frei von Wasser, Schnee und Eis).",
    answer: `• Dieser LKW hat keine Plane → Bordwände nicht beschädigt, Wechselbrücke/Stützen gesichert
• Dachfläche: kein Schnee, Eis, Wasser, Flaschen, Äste
• Falls Plane vorhanden: nicht eingerissen, richtig gespannt, Spriegel fest, nicht verbogen, Höhe richtig eingestellt

Obenliegende Teile immer mitdenken – Absturzgefahr.`
  },

  // Karte 9
  {
    id: "K9F1",
    card: 9,
    title: "Frage 1: Benennen der Symbole auf dem Fahrtenschreiber.*",
    answer: `• Hammer = Arbeitszeit
• Bett = Ruhezeit
• Kreis mit Punkt = Lenkzeit
• Viereck mit Schrägstrich = Bereitschaft

Symbole richtig deuten = korrekte Eintragungen.`
  },
  {
    id: "K9F2",
    card: 9,
    title: "Frage 2: Sichtprüfung der Betriebs- und Feststellbremse.",
    answer: `• Bremsscheiben: keine Risse, Brüche, blauen Verfärbungen, tiefen Riefen, nicht ölig
• Bremsbeläge im Bordcomputer kontrollieren
• Feststellbremse anziehen und Halt prüfen
• Kombizylinder: Schraube darf nicht rausgedreht sein

Bremsen prüfen = Lebensversicherung.`
  },
  {
    id: "K9F3",
    card: 9,
    title: "Frage 3: Ölstand der Servolenkung prüfen.",
    answer: `• Beim LKW nicht manuell prüfbar
• Bei zu geringem Stand erscheint eine Warnmeldung im Cockpit
• Zusätzlich merkbar, wenn Lenkung schwergängig wird

Warnmeldung beachten – nicht am Behälter prüfen.`
  },
  {
    id: "K9F4",
    card: 9,
    title: "Frage 4: Schlussleuchten, Umrissleuchten hinten, Funktion prüfen.",
    answer: `• Fahrlehrer schaltet das Licht ein
• Fahrschüler geht hinter den LKW
• Schlussleuchten links/rechts prüfen
• Umrissleuchten hinten prüfen

Immer hinten kontrollieren – beide Seiten beachten.`
  },
  {
    id: "K9F5",
    card: 9,
    title: "Frage 5: Überprüfung der Scheibenwaschanlage und der Einstellung der Spritzdüsen.",
    answer: `• Zündung einschalten, Scheibenwaschanlage betätigen
• Wasser aus allen Düsen verteilt sich gleichmäßig
• Scheibenwischer schmieren nicht, Scheibe wird sauber
• Verstopfte Düse: mit Nadel einstellen/freimachen

Gleichmäßige Verteilung = klare Sicht.`
  },
  {
    id: "K9F6",
    card: 9,
    title: "Frage 6: Zustand der Scheiben und Spiegel (Sauberkeit, Beschädigung).",
    answer: `• Spiegel: fest, nicht wackelnd, nicht beschädigt, keine schwarzen Punkte, nicht milchig
• Windschutzscheibe: sauber, nicht beschädigt, keine Steinschläge im Sichtfeld/Kamerabereich

Freie Sicht = sichere Fahrt.`
  },

  // Karte 10
  {
    id: "K10F1",
    card: 10,
    title: "Frage 1: Überprüfung eines Schaublattes bzw. eines Ausdruckes des Fahrtenschreibers.*",
    answer: `a) Wie viele km wurden gefahren?
b) Wie lange war die Fahrtunterbrechung?
c) Nach wie viel Stunden wurde die erste Pause eingelegt?
d) Welche Höchstgeschwindigkeit wurde gefahren bzw. wurden Geschwindigkeitsüberschreitungen dokumentiert?

• Gefahrene Strecke: 89 km
• Fahrtunterbrechung: 20 Stunden 26 Minuten
• Erste Pause: nach 1 Stunde 47 Minuten
• Geschwindigkeitsüberschreitungen: keine dokumentiert

Werte am Ausdruck ablesen – nichts schätzen.`
  },
  {
    id: "K10F2",
    card: 10,
    title: "Frage 2: Prüfen, ob Pedalwege frei sind.",
    answer: `• Unter die Pedale schauen: keine Gegenstände (z. B. Handschuhe, Hausschuhe, Flaschen)
• Gas und Bremse betätigen: freigängig, kein Widerstand
• Im Fahrerhaus schauen: keine losen Teile oder Flaschen, die nach vorne rollen können

Freie Pedale = sichere Bedienung.`
  },
  {
    id: "K10F3",
    card: 10,
    title: "Frage 3: Sichtprüfung der Federung.",
    answer: `• LKW mit Luftfederung anheben
• Luftbalg: keine Risse, Schnitte, Beulen, nicht porös, läuft sauber über den Topf
• Topf darf nicht stark verrostet sein
• Stoßdämpfer zeigen: darf kein Öl austreten

Stoßdämpfer sind wichtig – werden oft vernachlässigt.`
  },
  {
    id: "K10F4",
    card: 10,
    title: "Frage 4: Kontrolllampen benennen oder Kontrollsysteme aktivieren und an zwei Beispielen erläutern.",
    answer: `• Zwei Kontrollleuchten benennen (z. B. Feststellbremse rot, Fernlicht blau)
• Kontrollsysteme: Kraftstoffanzeige, Druckmesser/Manometer
• Wenn Prüfer eine unbekannte Leuchte zeigt: Hinweis auf Betriebsanleitung

Mindestens zwei Beispiele nennen – das reicht dem Prüfer.`
  },
  {
    id: "K10F5",
    card: 10,
    title: "Frage 5: Überprüfung der Zustandsanzeige für die Luftfilteranlage.",
    answer: `• Kontrollleuchte Luftfilter zeigen
• Bleibt die Leuchte an, ist der Luftfilter verstopft

Leuchte an = Filter dicht.`
  },
  {
    id: "K10F6",
    card: 10,
    title: "Frage 6: Unterlegkeile (Anzahl, Unterbringung).",
    answer: `• Unterbringung in Halterung prüfen
• Anzahl vollständig (bei 3 Achsen: 2 Keile)
• Keile nicht beschädigt, passend zur Reifengröße
• Auf die Eiskanten achten – dürfen nicht beschädigt sein

Nur vollständige, passende Keile sichern richtig.`
  }
];

const STORAGE_KEY_PROGRESS = "abfahrtskontrolle_progress_v1";
const STORAGE_KEY_NOTES = "abfahrtskontrolle_notes_v1";

let progress = {};
let notes = {};
try {
  progress = JSON.parse(localStorage.getItem(STORAGE_KEY_PROGRESS) || "{}");
} catch (e) { progress = {}; }
try {
  notes = JSON.parse(localStorage.getItem(STORAGE_KEY_NOTES) || "{}");
} catch (e) { notes = {}; }

const cardFilterEl = document.getElementById("cardFilter");
const cardListEl = document.getElementById("cardList");
const progressFillEl = document.getElementById("progressFill");
const progressTextEl = document.getElementById("progressText");
const modeInfoEl = document.getElementById("modeInfo");
const nextInQuizBtn = document.getElementById("nextInQuiz");
const resetAllBtn = document.getElementById("resetAll");
const modeCardsBtn = document.getElementById("modeCardsBtn");
const modeQuizBtn = document.getElementById("modeQuizBtn");
const modeExamBtn = document.getElementById("modeExamBtn");

let currentMode = "cards";
let examQuestions = [];
let examIndex = 0;
let examCorrect = 0;
let examWrong = 0;
let examActive = false;

const maxCard = Math.max(...QUESTIONS.map(q => q.card));
for (let c = 1; c <= maxCard; c++) {
  const opt = document.createElement("option");
  opt.value = String(c);
  opt.textContent = "Karte " + c;
  cardFilterEl.appendChild(opt);
}

function saveProgress() {
  localStorage.setItem(STORAGE_KEY_PROGRESS, JSON.stringify(progress));
}
function saveNotes() {
  localStorage.setItem(STORAGE_KEY_NOTES, JSON.stringify(notes));
}

function getFilteredQuestions() {
  const cardVal = cardFilterEl.value;
  if (cardVal === "all") return QUESTIONS;
  const c = Number(cardVal);
  return QUESTIONS.filter(q => q.card === c);
}

function updateProgressDisplay() {
  const all = QUESTIONS.length;
  const knownCount = QUESTIONS.filter(q => progress[q.id]?.last === "known").length;
  const percent = all ? Math.round(knownCount / all * 100) : 0;
  progressFillEl.style.width = percent + "%";
  progressTextEl.textContent = `Fortschritt: ${knownCount} / ${all} (${percent}%)`;
}

function addImageSupport(cardElement, q) {
  if (!q.image) return;

  const imgWrapper = document.createElement("div");
  imgWrapper.className = "image-wrapper";

  const img = document.createElement("img");
  img.src = q.image;
  img.alt = q.imageLabel || "Abbildung zur Frage";
  imgWrapper.appendChild(img);

  if (q.imageLabel) {
    const cap = document.createElement("div");
    cap.className = "image-caption";
    cap.textContent = q.imageLabel;
    imgWrapper.appendChild(cap);
  }

  cardElement.appendChild(imgWrapper);
  return imgWrapper;
}

function renderQuestions() {
  if (currentMode === "exam") {
    renderExamView();
    return;
  }

  const filtered = getFilteredQuestions();
  cardListEl.innerHTML = "";

  let questionsToRender = filtered;

  if (currentMode === "quiz") {
    if (filtered.length === 0) return;
    const idx = Math.floor(Math.random() * filtered.length);
    questionsToRender = [filtered[idx]];
  }

  questionsToRender.forEach(q => {
    const card = document.createElement("div");
    card.className = "question-card";

    const meta = document.createElement("div");
    meta.className = "question-meta";

    const left = document.createElement("div");
    left.textContent = `Karte ${q.card} • Frage-ID: ${q.id}`;

    const right = document.createElement("div");
    const prog = progress[q.id];
    const chip = document.createElement("span");
    chip.className = "chip small";
    if (prog?.last === "known") {
      chip.classList.add("known");
      chip.textContent = "Status: sitzt (Wusste ich)";
    } else if (prog?.last === "unknown") {
      chip.classList.add("unknown");
      chip.textContent = "Status: unsicher (Musste nachschauen)";
    } else {
      chip.textContent = "Status: noch offen";
    }
    right.appendChild(chip);

    meta.appendChild(left);
    meta.appendChild(right);

    const title = document.createElement("div");
    title.className = "question-title";
    title.textContent = q.title;

    const answer = document.createElement("div");
    answer.className = "answer hidden";
    answer.textContent = q.answer;

    const buttons = document.createElement("div");
    buttons.className = "card-buttons";

    const showBtn = document.createElement("button");
    showBtn.textContent = "Antwort anzeigen";
    showBtn.addEventListener("click", () => {
      const hidden = answer.classList.contains("hidden");
      if (hidden) {
        answer.classList.remove("hidden");
        showBtn.textContent = "Antwort ausblenden";
      } else {
        answer.classList.add("hidden");
        showBtn.textContent = "Antwort anzeigen";
      }
    });

    const knewBtn = document.createElement("button");
    knewBtn.textContent = "Wusste ich ✅";
    knewBtn.className = "primary";
    knewBtn.addEventListener("click", () => {
      const p = progress[q.id] || { correct: 0, wrong: 0 };
      p.correct++;
      p.last = "known";
      progress[q.id] = p;
      saveProgress();
      updateProgressDisplay();
      if (currentMode === "quiz") {
        renderQuestions();
      }
    });

    const notKnewBtn = document.createElement("button");
    notKnewBtn.textContent = "Musste nachschauen ❌";
    notKnewBtn.addEventListener("click", () => {
      const p = progress[q.id] || { correct: 0, wrong: 0 };
      p.wrong++;
      p.last = "unknown";
      progress[q.id] = p;
      saveProgress();
      updateProgressDisplay();
      if (currentMode === "quiz") {
        renderQuestions();
      }
    });

    buttons.appendChild(showBtn);
    buttons.appendChild(knewBtn);
    buttons.appendChild(notKnewBtn);

    const imgWrapper = addImageSupport(card, q);
    if (imgWrapper) {
      const imgBtn = document.createElement("button");
      imgBtn.textContent = "Bild anzeigen";
      imgBtn.addEventListener("click", () => {
        const isHidden = imgWrapper.style.display === "none" || imgWrapper.style.display === "";
        imgWrapper.style.display = isHidden ? "block" : "none";
        imgBtn.textContent = isHidden ? "Bild ausblenden" : "Bild anzeigen";
      });
      buttons.appendChild(imgBtn);
    }

    const noteLabel = document.createElement("div");
    noteLabel.className = "note-label";
    noteLabel.textContent = "Notizen:";

    const noteArea = document.createElement("textarea");
    noteArea.value = notes[q.id] || "";
    noteArea.placeholder = "Eigene Stichworte oder Beispiele ergänzen …";
    noteArea.addEventListener("change", () => {
      notes[q.id] = noteArea.value;
      saveNotes();
    });

    card.appendChild(meta);
    card.appendChild(title);
    card.appendChild(buttons);
    card.appendChild(answer);
    card.appendChild(noteLabel);
    card.appendChild(noteArea);

    cardListEl.appendChild(card);
  });

  updateProgressDisplay();
}

function shuffleArray(arr) {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function startExam() {
  const filtered = getFilteredQuestions();
  examQuestions = shuffleArray(filtered);
  examIndex = 0;
  examCorrect = 0;
  examWrong = 0;
  examActive = examQuestions.length > 0;
  renderExamView();
}

function renderExamView() {
  cardListEl.innerHTML = "";

  if (!examActive || examQuestions.length === 0) {
    const info = document.createElement("div");
    info.className = "question-card";
    info.textContent = "Keine Fragen für den Prüfungsmodus gefunden. Bitte andere Karte wählen.";
    cardListEl.appendChild(info);
    return;
  }

  if (examIndex >= examQuestions.length) {
    const total = examQuestions.length;
    const percent = total ? Math.round((examCorrect / total) * 100) : 0;

    const summaryCard = document.createElement("div");
    summaryCard.className = "question-card";

    const title = document.createElement("div");
    title.className = "exam-summary-title";
    title.textContent = "Prüfung beendet";

    const line1 = document.createElement("div");
    line1.className = "exam-summary-line";
    line1.textContent = `Fragen insgesamt: ${total}`;

    const line2 = document.createElement("div");
    line2.className = "exam-summary-line";
    line2.textContent = `Davon „Wusste ich“: ${examCorrect}`;

    const line3 = document.createElement("div");
    line3.className = "exam-summary-line";
    line3.textContent = `Davon „Musste nachschauen“: ${examWrong}`;

    const line4 = document.createElement("div");
    line4.className = "exam-summary-line";
    line4.textContent = `Ergebnis: ${percent}% sicher beantwortet`;

    const buttons = document.createElement("div");
    buttons.className = "card-buttons";
    const restartBtn = document.createElement("button");
    restartBtn.className = "primary";
    restartBtn.textContent = "Prüfung erneut starten";
    restartBtn.addEventListener("click", () => {
      startExam();
    });

    const backToCardsBtn = document.createElement("button");
    backToCardsBtn.textContent = "Zurück zu Lernkarten";
    backToCardsBtn.addEventListener("click", () => {
      setMode("cards");
    });

    buttons.appendChild(restartBtn);
    buttons.appendChild(backToCardsBtn);

    summaryCard.appendChild(title);
    summaryCard.appendChild(line1);
    summaryCard.appendChild(line2);
    summaryCard.appendChild(line3);
    summaryCard.appendChild(line4);
    summaryCard.appendChild(buttons);

    cardListEl.appendChild(summaryCard);
    updateProgressDisplay();
    return;
  }

  const q = examQuestions[examIndex];

  const card = document.createElement("div");
  card.className = "question-card";

  const meta = document.createElement("div");
  meta.className = "question-meta";

  const left = document.createElement("div");
  left.textContent = `Frage ${examIndex + 1} von ${examQuestions.length} • Karte ${q.card} • ID: ${q.id}`;

  const right = document.createElement("div");
  const chip = document.createElement("span");
  chip.className = "chip small";
  chip.textContent = "Prüfungsmodus";
  right.appendChild(chip);

  meta.appendChild(left);
  meta.appendChild(right);

  const title = document.createElement("div");
  title.className = "question-title";
  title.textContent = q.title;

  const answer = document.createElement("div");
  answer.className = "answer hidden";
  answer.textContent = q.answer;

  const buttons = document.createElement("div");
  buttons.className = "card-buttons";

  const showBtn = document.createElement("button");
  showBtn.textContent = "Antwort anzeigen";
  showBtn.addEventListener("click", () => {
    const hidden = answer.classList.contains("hidden");
    if (hidden) {
      answer.classList.remove("hidden");
      showBtn.textContent = "Antwort ausblenden";
    } else {
      answer.classList.add("hidden");
      showBtn.textContent = "Antwort anzeigen";
    }
  });

  const knewBtn = document.createElement("button");
  knewBtn.textContent = "Wusste ich ✅";
  knewBtn.className = "primary";
  knewBtn.addEventListener("click", () => {
    const p = progress[q.id] || { correct: 0, wrong: 0 };
    p.correct++;
    p.last = "known";
    progress[q.id] = p;
    examCorrect++;
    saveProgress();
    updateProgressDisplay();
    examIndex++;
    renderExamView();
  });

  const notKnewBtn = document.createElement("button");
  notKnewBtn.textContent = "Musste nachschauen ❌";
  notKnewBtn.addEventListener("click", () => {
    const p = progress[q.id] || { correct: 0, wrong: 0 };
    p.wrong++;
    p.last = "unknown";
    progress[q.id] = p;
    examWrong++;
    saveProgress();
    updateProgressDisplay();
    examIndex++;
    renderExamView();
  });

  buttons.appendChild(showBtn);
  buttons.appendChild(knewBtn);
  buttons.appendChild(notKnewBtn);

  const imgWrapper = addImageSupport(card, q);
  if (imgWrapper) {
    const imgBtn = document.createElement("button");
    imgBtn.textContent = "Bild anzeigen";
    imgBtn.addEventListener("click", () => {
      const isHidden = imgWrapper.style.display === "none" || imgWrapper.style.display === "";
      imgWrapper.style.display = isHidden ? "block" : "none";
      imgBtn.textContent = isHidden ? "Bild ausblenden" : "Bild anzeigen";
    });
    buttons.appendChild(imgBtn);
  }

  const noteLabel = document.createElement("div");
  noteLabel.className = "note-label";
  noteLabel.textContent = "Notizen (optional, wirkt sich nicht auf das Ergebnis aus):";

  const noteArea = document.createElement("textarea");
  noteArea.value = notes[q.id] || "";
  noteArea.placeholder = "Eigene Stichworte oder Beispiele ergänzen …";
  noteArea.addEventListener("change", () => {
    notes[q.id] = noteArea.value;
    saveNotes();
  });

  card.appendChild(meta);
  card.appendChild(title);
  card.appendChild(buttons);
  card.appendChild(answer);
  card.appendChild(noteLabel);
  card.appendChild(noteArea);

  cardListEl.appendChild(card);

  updateProgressDisplay();
}

function setMode(mode) {
  currentMode = mode;

  modeCardsBtn.classList.remove("primary");
  modeQuizBtn.classList.remove("primary");
  modeExamBtn.classList.remove("primary");
  nextInQuizBtn.style.display = "none";

  if (mode === "cards") {
    modeCardsBtn.classList.add("primary");
    modeInfoEl.innerHTML = "Modus: <strong>Lernkarten</strong> – blättere durch alle Fragen, zeige dir die Antwort an und bewerte dich.";
    renderQuestions();
  } else if (mode === "quiz") {
    modeQuizBtn.classList.add("primary");
    nextInQuizBtn.style.display = "inline-block";
    modeInfoEl.innerHTML = "Modus: <strong>Quiz</strong> – es wird immer eine zufällige Frage aus dem aktuellen Kartenbereich angezeigt. Nach deiner Bewertung oder mit „Nächste Frage“ geht es weiter.";
    renderQuestions();
  } else if (mode === "exam") {
    modeExamBtn.classList.add("primary");
    modeInfoEl.innerHTML = "Modus: <strong>Prüfungsmodus</strong> – alle Fragen im aktuellen Kartenbereich werden genau einmal abgefragt. Am Ende erhältst du eine Auswertung in Prozent.";
    startExam();
  }
}

modeCardsBtn.addEventListener("click", () => setMode("cards"));
modeQuizBtn.addEventListener("click", () => setMode("quiz"));
modeExamBtn.addEventListener("click", () => setMode("exam"));

nextInQuizBtn.addEventListener("click", () => {
  if (currentMode === "quiz") {
    renderQuestions();
  }
});

cardFilterEl.addEventListener("change", () => {
  if (currentMode === "exam") {
    startExam();
  } else {
    renderQuestions();
  }
});

resetAllBtn.addEventListener("click", () => {
  const sure = confirm("Willst du wirklich ALLE Lernfortschritte und Notizen löschen?");
  if (!sure) return;

  progress = {};
  notes = {};
  localStorage.removeItem(STORAGE_KEY_PROGRESS);
  localStorage.removeItem(STORAGE_KEY_NOTES);

  examQuestions = [];
  examIndex = 0;
  examCorrect = 0;
  examWrong = 0;
  examActive = false;

  updateProgressDisplay();
  renderQuestions();
});

setMode("cards");
</script>
</body>
</html>
